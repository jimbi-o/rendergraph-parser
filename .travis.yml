dist: focal
os: linux
language: cpp
cache: ccache
env:
  global:
  - secure: I3LTsPtnq3vxxXpmP7hVyGiBoxbgvjdeQ9jbp18GoBfh5sV5wCrLH0CeaC54Rsb04Cm2tyWIheV3QtiSpEhTVM0FVG65eBz1bOe4q6GM/znSmCJgFC1Bsr+O+PnF8O+Be2Lz+f3sk5F+I0ikVjfXlr78AdOeuFa/7O7c9jMVtDqD1QSLJnTGsfQMtZ4JMMnLdzfmvcwJRlP/b1NW5e4hd9i57KWg6ooC4UfpVgODpjiMtsAviP/b3FndBUxVXkmTb4rdNoLEtHhlpQ2hhCNVoHDyqT/+w3GaCw0HbefbjGGduxWSFxH9kzE0n5Od0NWdY7LLt7G5GasPRTEPiIYFHddbqKgFt6nAaJwMKXyWHQcfaPVqTWHB+bTlBJmGjfIMDtyzDRGgqSDD8CaBpJ+VoL+PBZ0uDU2FZ/NBdrF2qVgV2/J5ly2Y/VKFdLf31NNJHL9MDkDMHS9Vk4NTLRpDp8maUvU0BLklsZq912oy4NqsATCug0dAchP+csHHyOYih2ASlBUe7V7ZQPCATKkMFHnGcgk5SXVLGyGZqprqW4MGBWPcO+jjAmz2tcw2vjtRzMbDAPZzZB3WYFgPFC21KDttVoATXz/meeg0mx7FG6+YDlQOCqp8tLwd9BiR2N/nsYyVkWKBrumsD5MOpjJZs7Qu5yQgcT3MxiLwRD0BBtA=
jobs:
  include:
  - compiler: gcc
    env:
    - COVERAGE=true
    - TEST_ON=ON
    - CXX_FLAGS="-O0 -g --coverage"
    addons:
      apt:
        packages: lcov
      coverity_scan:
        project:
          name: "$TRAVIS_REPO_SLUG"
        build_command_prepend: cmake -S . -B build -DBUILD_WITH_TEST=ON
        build_command: cmake --build build
        branch_pattern: coverity_scan
        notification_email: jimbi.o.nanamemaegami@gmail.com
  - compiler: gcc
    env:
    - TEST_ON=OFF
  - compiler: gcc
    env:
    - LIB_MODE=ON
  - compiler: clang
    env:
    - TEST_ON=ON
  - compiler: clang
    env:
    - TEST_ON=OFF
  - compiler: clang
    env:
    - LIB_MODE=ON
before_install: |
  mkdir -p $HOME/.ccache
  mkdir -p $HOME/.ccache/CPM
script: |
  cmake -S . -B build -DCMAKE_EXPORT_COMPILE_COMMANDS=ON -DBUILD_WITH_TEST=${TEST_ON} -DCMAKE_CXX_COMPILER_LAUNCHER=ccache -DCPM_SOURCE_CACHE=$HOME/.ccache/CPM -DCMAKE_CXX_FLAGS="$CXX_FLAGS"
  cmake --build build
  ./build/rendergraphparser
after_success: 'if [ $COVERAGE == true ] ; then bash -x scripts/run-codecov.sh; fi

  '
